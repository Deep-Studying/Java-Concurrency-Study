개요

---

**프로세스**나 **쓰레드**들이 서로가 소유하고 있는 **자원**을 기다리며 **무한히 대기**하는 상태

교착상태에서는 아무런 진전도 이루어지지 않아 작업이 **진행되지 않는 문제**가 발생한다.

**DeadLock**은 동일한 **환경**과 **코드**에서 발생할 수도 있고, 발생하지 않을 수도 있다.

---

### 데드락 발생조건

---

- **상호배제**
    - 자원은 한 번에 하나의 쓰레드만 사용할 수 있다.
- 점유대기
    - 쓰레드가 최소한 하나의 자원을 보유한 상태에서 다른 자원을 기다리고 있다.
- 비선점
    - 자원을 할당받은 쓰레드가 자원을 스스로 반납하기 전 까지 자원을 강제로 빼앗을 수 없다.
- 순환대기
    - 각 쓰레드는 순환적으로 다음 쓰레드가 요구하는 자원을 가지고 있어 사이클이 형성된다.

---

### 데드락 방지와 원인 추적

---

**데드락 발생조건 네 가지 중 최소한 1가지 방지, 네가지 모두 만족하지 않게 하는 기법**

데드락이 발생하면, 어플리케이션 단에서 해소하는 것은 어렵고 서버를 재기동 하거나 종료해야 한다.

---

- 한 번에 하나의 락을 사용한다
    - 데드락은 **쓰레드**가 **락**을 **중첩**적으로 **제어**하며 **발생**하는 경우가 많다.
- 락의 순서를 잘 조정한다.
    - **여러개의 락을** 사용해야 한다면, 락의 **점유순서**를 **일정한 순서**로 정해준다. (**순환대기** 방지)
- 락 타임아웃을 건다
    - 락을 요청할 때 일정시간 내에 락을 **얻지 못 하면** 다른 작업을 수행하도록 **타임아웃**을 설정한다.
    - **락 획득**에 **타임아웃 오류**가 나면, 오래 기다리지 않고 **제어권**이 돌아와서 정상 동작할 수 있다.
- 메서드는 오픈호출 형태로 구현한다.
    - 락을 **전체 메서드**에 **적용하지 않고**, 락이 **필요**한 **임계영역**만 **보호**하도록 한다.
- 쓰레드 덤프를  활용한다.
    - 쓰레드 덤프에는 실행중인 쓰레드의 모든 스택 트레이스가 담겨져있고 락 관련 정보도 포함
      되어있기에 이를 활용해서 어디에서 왜 데드락이 발생했는지 원인 추적 및 해결방안 모색이 가능

---

### 그 외 활동성 문제

---

- 기아상태
    - 멀티쓰레드 환경에서 한 쓰레드가 자원을 계속해서 얻지 못해 영구대기하는 상태
    - 다른 쓰레드가 우선적으로 자원을 점유, 실행하여 해당 쓰레드가 자원을 얻지 못하면 발생
    - 우선순위 기반 스케줄링이 아닌 모든 쓰레드가 공평하게 실행될 수 있도록 우선순위 조정 필요
- 라이브락
    - 데드락과 비슷하지만, 여러 쓰레드가 서로의 자원을 기다리며 진행이 지연되는 상태
    - 작업이 멈추지 않고, 계속 진행되지만 실질적 작업이 진행되지 않거나 제대로 이루어지지 않음
    - 쓰레드가 서로의 자원을 기다리기에 작업이 느려질 수 있으며 서로가 반복적으로 양보해 지연

---