### Monitor

개요

---

- 뮤텍스나 세마포어 보다 더 추상화시킨 고 수준의 동기화 기법
- 객체는 기본적으로 모니터를 가지고, 임계영역에 진입 시 JVM은 모니터로 쓰레드 간 동기화 제공
- 상호배제, 협력이라는 두 가지 동기화 기능을 제공하며 이를 위해 뮤텍스와 조건변수를 사용한다.

---

### 상호배제

---

- 객체가 가지고 있는 모니터락을 통해 여러 쓰레드가 동시에 공유자원에 접근하는 것을 막는 메커니즘
- JVM은 synchronized 키워드를 이용해 뮤텍스 동기화를 처리하며 메서드나 코드블록에 적용 가능
    - **synchronized**
        - 해당 객체의 모니터 락 획득, 획득한 쓰레드만이 임계영역에 접근 가능, 그 외 쓰레드는 대기
        - 블록을 빠져나오면 모니터락이 해제되고 대기중인 쓰레드가 락을얻고 작업을 수행하는 방식

---

### 협력

---

- 협력은 모니터의 조견변수를 통해 쓰레드 간 공동 목표를 위해 데이터의 일관성을 보장하는 메커니즘
    - **조건변수**
        - wait(), notify(), notifyAll()과 함께 작용하며 특정 조건 만족 전 까지 쓰레드를 대기시킴
- 조건변수를 통해 쓰레드 간 대기와 통지를 조절하며 레이스컨디션과 같은 문제를 방지할 수 있다.
- 모니터 내부는 여러 조건변수를 가질 수 있지만 자바의 모니터는 오직 한 개의 조건변수만을 가진다.

---

### 모니터 대기 세트 구조

---

- 모니터 내부는 **EntrySet, WaitSet** 자료구조가 있고 멀티쓰레드 환경에서 상호작용 조절에 사용
    - Entry Set
        - 모니터의 락을 획득하기 위해 대기중인 쓰레드들을 모아놓은 자료구조
        - 여기 있는 쓰레드들은 Lock 반납 전 까지 대기하고 반납되면 쓰레드가 임계영역 진입
    - Wait Set
        - 모니터의 조건변수와 사용하는 료구조, 쓰레드들이 조건에 만족할 때 까지 대기하는 장소
        - Wait Set에 들어가 대기할 때 Lock 해제, 깨어나면 Entry Set으로 이동해서 Lock 획득

---

### 조건변수 종류

---

- Signal and Wait
    - 모니터를 소유하고 있는 쓰레드가 wait() 실행 시, 중단 & Lock 해제 후 Wait Set에 들어간다.
    - 깨우는 쓰레드가 알릴 시 대기 쓰레드 중 하나 or 모든 쓰레드를 깨우고 Lock 해제 &대기한다.
- Signal and Continue
    - 모니터를 소유하고 있는 쓰레드가 wait() 실행 시, 중단 & Lock 해제 후 Wait Set에 들어간다.
    - 깨우는 쓰레드가 알릴 시 Wait Set에 있는 하나 또는 모든쓰레드를 깨우고 Entry Set으로 이동
    - 자바에서는 이 조건 변수 형식을 취하고 있다.

---