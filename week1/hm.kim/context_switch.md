# Context Switch

### Context

- 프로세스 간 전환을 위해 어디까지 명령을 수행했고, **CPU Register**에 저장된 값 정보가 필요하다.
- Context는 CPU가  프로세스를 실행하기 위한 정보, 운영체제가 관리하는 **PCB**라는 자료구조에 저장

## PCB (Process Control Block)

- 운영체제가 시스탬 내의 프로세스를 관리하기 위해 프로세스마다 유지하는 정보를 담는 **커널 내 자료구조**
- 컨텍스트 스위칭은 CPU가 프로세스 간 **PCB 정보를 교체하고 캐시를 비우는 일련의 과정**이라 볼수있다.

### 프로세스 상태

- New : 프로세스를 생성하고 있는 단계로 커널 영역에 PCB가 만들어진 상태
- Ready : 프로세스가 CPU를 할당받기 위해 기다리고 있는 상태
- Running : 프로세스가 CPU를 할당받아 명령어를 실행 중인 상태
- Waiting : 프로세스가 I/O 작업 완료 혹인 사건 발생을 기다리는 상태
- Terminated : 프로세스가 종료된 상태

### 컨텍스트 스위칭 조건

- 실행 프로세스에서 I/O 호출 후 작업이 끝날 때 까지 프로세스 **running → wating 상태로 전이된 경우**
- 운영체제의 CPU 스케쥴러 알고리즘에 의해 실행중인 프로세스가 사용할 수 있는 시간 자원을
  모두 사용했을 때 **해당 프로세스를 중지 (ready 상태로 전이) 다른 프로세스를 실행시켜주는 경우**

### 컨텍스트 스위칭 동작 과정

- Process1
    - **선점 → PCB1 저장 → 준비상태의 PCB2 호출 → 컨텍스트 스위칭 → 프로세스 전환**
- Process2
    - **실행 상태 → PCB2 저장 → 대기상태의 PCB1 호출 → 컨텍스트 스위칭 → 프로세스 전환**

### 쓰레드 컨텍스트 스위칭

- TCB (Thread Control Block)
    - 쓰레드 상태 정보를 저장하는 자료구조, **PC와 CPU정보, 그리고 PCB를 가리키는 포인터를 가진다.**
    - 쓰레드가 하나 생성될 때 PCB내에서 TCB 생성, 컨텍스트 스위칭 발생 시 기존 쓰레드의 TCB저장 후 새 쓰레드 TCB를 가져와서 실행한다.

### 프로세스 vs 쓰레드

- 프로세스는 컨텍스트 스위칭 전 메모리 관련 작업 (CPU 캐시 초기화, TLB 초기화) 등 **오버헤드가 크다.**
- 쓰레드는 **프로세스 내 메모리를 공유**해서 프로세스에 비해 오버헤드가 작아서 컨텍스트 스위칭이 빠르다.
- 생성 비용이 커서 많은 쓰레드 생성은 메모리 부족, **빈번한 컨텍스트 스위칭으로 성능이 저하될 수 있다.**