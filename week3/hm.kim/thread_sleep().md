### 개요

---

- **지정된 시간동안 현재 쓰레드의 실행을 일시 정지하고 대기상태로 빠졌다 실행대기 상태로 전환**된다.
- 네이티브 메서드로 연결되며 시스템 콜을 통해 커널모드에서 수행후 유저모드로 전환하게 된다.

### API 및 예외

---

- **static sleep (long millis) throws InterruptedException**
    - 지정한 **밀리초 시간동안 쓰레드를 수면 상태로 만든다.**
    - 밀리초에 대한 인수 값은 음수가 될 수 없으며 음수 일 경우 IllegalArgumentException 발생

    ---

- **static sleep (long millis, int nanos) InterruptedException**
    - 지정한 **밀리초에 나노초를 더한 시간 동안 쓰레드를 수면 상태**로 만든다.
    - 나노초의 범위는 0~999999이다.

    ---

- **InterruptedException**
    - 쓰레드가 **수면중에 인터럽트 될 경우 InterruptedException** 예외를 발생시킨다.
    - 다른 쓰레드는 잠자고 있는 쓰레드에게 인터럽트, 즉 중단  (멈춤) 신호를 보낼 수 있다.
    - 예외가 발생하면 쓰레드는 수면 상태에서 꺠어나고 실행대기 상태로 전환되어 실행상태를 기다린다.

    ---

- 기본 코드 방식

```
try { //try-catch
	Thread.sleep(3000); // 3초간 일시정지
		busness logic ...
} catch (InterruptedException e) {
	// 인터럽트 발생 시 예외 처리 필요
}
```

- sleep() 작동 방식
  - 지정된 시간이 지남

  ```
      Scheduler → Thread-1 → Runnable → sleep() → TIMED WAITING → Runnable
  ```

- interrupt() 발생 시
    
  ```
  // thread-2가 수면 상태에 있는 thread-1에게 인터럽트를 걸어 수면을 깨우고 실행대기상태로 전환
          
             Thread-1 → Runnable → sleep() → TIMED WAITING → Runnable → InterruptedException
  Scheduler ↗️
            ↘️
             Thread-2 -> Runnable -> interrupt()
    			 
  // thread-1이 수면 상태로 인해 일시정지 되고 thread-2가 실행으로 context switch
  ```
    
  ---

- sleep(0)과 sleep(n)의 의미
    - sleep(millis) 메서드는 **네이티브 메서드** 이기에 **시스템 콜을 호출해서  커널모드로 전환된다.**
    - 다른 쓰레드에게 **명확하게 실행을 양보하기 위함이라면 sleep(0)보다 sleep(1)을 사용한다.**

---

- sleep(0)
    - 쓰레드가 커널 모드로 전환 후 스케줄러는 현재 쓰레드와 동일한 우선순위 쓰레드가 있는 경우, **실행대기 상태에서 쓰레드에게 CPU를 할당함으로 컨텍스트 스위칭을 발생시키게 된다.**
    - 만약, 우선순위가 동일한 실행대기 상태의 다른 쓰레드가 없으면 스케줄러는
      **현재 쓰레드에게 계속 CPU를 할당해서 컨텍스트 스위칭이 없고 모드 전환만** 일어나게 된다.

    ---

- sleep(n)
    - 쓰레드가 커널 모드로 전환 후 스케줄러는 조건에 상관없이 현재 쓰레드를 대기상태에 두고, 다른 쓰레드에게 CPU를 할당함으로 모든 전환과 함께 컨텍스트 스위칭이 발생한다.

---

- sleep() 작동 방식

```
1. sleep()이 되면, OS 스케줄러는 현재 쓰레드를 지정된 시간 동안 대기상태로 전환하고 다른 쓰레드 혹은 프로세스에게 CPU를 사용하도록 한다.
2. 대기 시간이 끝나면, 쓰레드 상태는 바로 실행상태가 아닌 실행 대기 상태로 전환되고 CPU가 실행을 재개할 때 까지 기다린다.
3. 실행 상태가 되면 쓰레드는 남은 지점부터 실행을 다시 시작한다.
4. 동기화 메서드 영역에서 수면중인 쓰레드는 획득한 모니터나 락을 잃지 않고 계속 유지한다.
5. sleep() 중인 쓰레드에게 인터럽트가 발생할 경우 현재 쓰레드는 대기에서 해제되고 실행상태로 전환되어 예외를 처리하게 된다.
6. 쓰레드의 수면 시간은 OS 스케줄러 및 시스템 기능에 따라 제한되기에 정확성이 보장되지 않으며 시스템 부하가 많고 적음에 따라 지정한 수면 시간과 차이가 날 수 있다.
```