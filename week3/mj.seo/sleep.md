# Thread API - sleep()

### What is sleep()?

- 지정된 시간동안 현재 `스레드`의 실행을 **일시 정지**하고 `대기상태`로 빠진후, 지정한 시간이 지나면 **실행대기** 상태로 전환된다.
- `Native Method`로 연결되어 **시스템 콜**을 통해 **커널모드**에서 수행 후 **유저모드**로 **전환**된다.

### API Implementation

- **static sleep(long millis) throw InterruptedException**
    - 지정한 `밀리초` 시간 동안 **스레드**를 **수면상태**로 만든다.
    - 인자 값이 `음수`일 경우 **IllegalArgumentException**이 발생된다.

- **static sleep(long millis, int nanos) throws Interrupted Expcetion**
    - 지정한 `밀리초`에 `나노초`를 더한 시간 동안 **스레드**를 **수면상태**로 만든다.
    - 나노초의 범위는 `0-99999` 까지이다.

- **InterruptedException**
    - 스레드가 수면 중에 **Interrupt** 되면 **InterruptedException** 예외가 발생된다.
    - 다른 스레드는 잠자고 있는 `Thread`에게 `Interrupt`를 걸 수 있다.
    - `InterruptedException`이 발생하면 수면 상태에서 깨어나고 **실행대기 상태**로 **전환**된다.
        - 바로 실행되는 것처럼 보이지만, 실행대기 상태로 `전환`되었다가  CPU `할당`을 받고 실행되는 것이다.

### sleep()의 동작 방식

- `지정된 시간이 지났을때`
    - 지정된 수면 시간이 끝나면 **실행대기 상태**로 **전환**한다.

- `interrupt() 발생시`
    - 특정 스레드가 `Timed-Waiting` 상태인 `스레드`에게 **인터럽트**를 걸면 실행대기 상태로 전환된다.
    - 실행대기 상태로 전환된 `스레드`는 실행 상태가 되면 **예외**를 **처리**한다.

### sleep(0) vs sleep(n)

- `sleep(0)`
    - **스레드**가 커널 모드로 전환 후 `스케줄러`는 현재 스레드와 동일한 `우선순위`의 `스레드`가 있을때, 실행대기 상태인 **스레드**에게 **CPU**를 `할당`한다.
    - **우선순위**가 동일한 실행대기 상태의 **다른 스레드**가 없으면 현재 스레드에게 계속 `CPU`를 할당하므로, **컨텍스트 스위칭**이 없고 `모드 전환`만 일어나게된다.

- `sleep(n)`
    - **스레드**가 커널 모드로 전환 후 `스케줄러`는 조건에 상관없이 현재 **스레드**를 대기상태로 두고 **다른 스레드**에게 `CPU`를 할당한다.

`다른 스레드`에게 명확하게 **실행**을 **양보**하려는 목적이라면 `sleep(1)`을 **사용**해야 한다.

### sleep() TMI

- `실행 상태`가 되면 **남은 지점**부터 **실행**을 다시 시작한다.
- `동기화 메서드` 영역에서 수면 중인 스레드는 획득한 **Monitor**나 **Lock**을 유지한다.
    - `반대되는 동작` ⇒ { **wait()** 은 모든 **Monitor**와 **Lock**을 반환한다. }
- `sleep()` 중인 스레드에 **interrupt**가 발생하면 스레드는 대기에서 해제되고 `실행상태`로 **전환**되며 **예외**를 **처리**한다.
- 스레드의 수면 시간은 `OS 스케줄러` 및 시스템에 따라서 `제한`되는 부분이 있어, **정확성**이 보장되지 않는다.
