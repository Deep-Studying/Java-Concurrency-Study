# 쓰레드 실행 및 종료 
---

자바 쓰레드는 OS 스케쥴러에 의해 실행 순서가 결정되며 쓰레드 실행 시점을 JVM에서 제어할 수 없다.

새로운 쓰레드는 현재 쓰레드와 독립 실행되고 최대 한번 시작할 수 있고 종료 후에는 다시 시작할 수 없다.

- 쓰레드 실행
- **start() - 쓰레드를 실행시키는 메서드로 시스템 콜을 통해 커널에 커널 쓰레드 생성을 요청한다.**
1. 메인 쓰레드가 새로운 쓰레드를 생성한다
2. 메인 쓰레드가 start() 메서드를 호출해서 쓰레드를 실행한다.
3. 네이티브 메서드 start()를 호출해 커널에게 커널쓰레드 생성 시스템콜을 요청한다.
4. 커널쓰레드가 생성되고 자바쓰레드와 커널쓰레드가 1:1 매핑이 이루어진다.
5. 커널쓰레드는 OS스케쥴러로부터 CPU 할당을 받기까지 실행대기 상태에 있다.
6. 커널쓰레드가 스케쥴러에 의해 실행상태가 되면 JVM에서 매핑된 자바 쓰레드의 run() 호출

---

- **run() - 쓰레드가 실행이 되면 해당 쓰레드에 의해 자동으로 호출되는 메서드이다.**
  - Thread()의 run()이 자동 호출, Runnable 구현체가 존재할 경우 Runnable의 run()을 실행
  - public static void main(String[] args)이 메인 쓰레드에 의해 자동 호출되는 것과 비슷하다.
  - 주의점은 start()가 아닌 run() 메서드를 직접 호출하면 실행스택에서 run()이 실행될 뿐이다.

---

- 쓰레드 스택(Stack)
  - 쓰레드가 생성되면 해당 **쓰레드를 위한 스택이 같이 만들어진다.**
  - 스택은 각 쓰레드마다 **독립적으로 할당되어 작동하기에 쓰레드 간 접근이 불가하다.**
  - 스택은 OS에 따라 크기가 주어지고 주어진 크기를 넘기면 StackOverFlow가 발생한다.

---

- 스택의 구성정보
  - 메모리 접근은 Push & Pop에 의한 후입선출 (LIFO : Last In First Out) 순서로 이루어진다.
  - 프레임으로 구성되어 있고 **새 메서드를 호출할 때 마다 로컬 변수 및 객체 참조 변수와 함께 push**
  - **메서드 실행이 완료되면 해당 스택 프레임이 pop**되고 흐름이 호출한 메서드로 돌아가며 사용가능

---

- 스택 메모리 상태 관리
  - 스택 내부의 변수는 변수를 생성한 **메서드가 실행되는 동안에만 존재한다.**
  - 스택 메모리에 대한 액세스는 **Heap 메모리와 비교할 때 빠르다.**
- --
- 쓰레드 종료
  - run() 메서드 코드가 **모두 실행되면 자동 종료**
  - **예외가 발생할 경우 종료되며 다른 쓰레드에 영향을 주지 않는다.**
  - 어플리케이션은 싱글쓰레드인 경우와 멀티쓰레인 경우 **종료 기준이 다르다.**
    - **싱글쓰레드 어플리케이션**
      - 사용자 쓰레드가 없는 기본 쓰레드만 있는 상태이다.
      - 기본 쓰레드가 종료되면 어플리케이션이 종료된다.
    - **멀티쓰레드 어플리케이션**
      - JVM에서 실행하고 있는 모든 쓰레드가 종료되어야 어플리케이션이 종료된다.
      - 코드를 실행하는 각 쓰레드의 종료시점은 처리 시간 및 OS의 스케줄링에 의해 결정된다.